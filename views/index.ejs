<% 
const familyData = {
    title: "Our Family Legacy",
    members: [
        { id: "gran", name: "Grandpa", img: "granny.png", top: 82.5, left: 33.1, mTop: 10, mLeft: 50 },
        { id: "gran", name: "Granny", img: "granny.png", top: 80.5, left: 40.4, mTop: 15, mLeft: 50 },
        { id: "gma1c", name: "Grandma", img: "Grandma.png", top: 80.5, left: 60, mTop: 20, mLeft: 50 },
        { id: "gpa1c", name: "Grandpa", img: "GrandpaC.png", top: 82.5, left: 67, mTop: 25, mLeft: 50 },
        { id: "dad", name: "Dad", img: "Dad.png", top: 65.8, left: 47.2, mTop: 35, mLeft: 40 },
        { id: "mom", name: "Mom", img: "Mom.png", top: 65.8, left: 52.8, mTop: 35, mLeft: 60 },
        { id: "amy", name: "Amy", img: "Amy.png", top: 53.8, left: 64.8, mTop: 45, mLeft: 70 },
        { id: "jo", name: "Jo", img: "Jo.png", top: 45.8, left: 76.8, mTop: 50, mLeft: 80 },
        { id: "wendy", name: "Wendy", img: "wendy.png", top: 50.8, left: 50.1, mTop: 45, mLeft: 50 },
        { id: "rich", name: "Rich", img: "rich.png", top: 53.8, left: 35.1, mTop: 45, mLeft: 30 },
        { id: "devon", name: "Devon", img: "Devon.png", top: 46.8, left: 24.1, mTop: 50, mLeft: 20 },
        { id: "belle", name: "Belle", img: "belle.png", top: 42.8, left: 17.1, mTop: 55, mLeft: 10 },
        { id: "dylan", name: "Dylan", img: "Dylan.png", top: 55.8, left: 14.1, mTop: 40, mLeft: 10 },
        { id: "axel", name: "Axel", img: "Axel.png", top: 36.8, left: 10.1, mTop: 60, mLeft: 10 },
        { id: "peanut", name: "Peanut", img: "peanut.png", top: 30.8, left: 20.1, mTop: 65, mLeft: 20 },
        { id: "dixie", name: "Dixie", img: "dixie.png", top: 37.0, left: 35.1, mTop: 60, mLeft: 35 },
        { id: "maria", name: "Maria", img: "maria.png", top: 44.0, left: 59.8, mTop: 55, mLeft: 60 },
        { id: "jason", name: "Jason", img: "jason.png", top: 38.0, left: 65.8, mTop: 60, mLeft: 65 },
        { id: "rhi", name: "Rhi", img: "rhi.png", top: 30.8, left: 57.8, mTop: 65, mLeft: 60 },
        { id: "joel", name: "Joel", img: "joel.png", top: 39.8, left: 45.2, mTop: 60, mLeft: 50 },
        { id: "maggy", name: "Maggy", img: "maggy.png", top: 28.8, left: 43.2, mTop: 70, mLeft: 50}
    ]
};
%>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= familyData.title %></title>
    <style>
        :root {
            --trunk: #5d4037;
            --cream: #f4ece1;
        }

        body { 
            background-color: var(--cream); 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            height: 100vh;
            overflow: hidden;
            font-family: 'Georgia', serif;
        }

        h1 { 
            color: var(--trunk);
            margin: 2vh 0;
            font-variant: small-caps;
            font-size: 4vh;
        }

        .tree-viewport {
            position: relative;
            height: 80vh;
            aspect-ratio: 679 / 401;
            background-image: url('tree.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .member-card {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            transform: translate(-50%, -50%);
            text-decoration: none;
            z-index: 10;
        }

        .photo-circle {
            width: 8vh;
            height: 8vh;
            border-radius: 50%;
            border: 0.4vh solid white;
            box-shadow: 0 0.5vh 1vh rgba(0,0,0,0.2);
            overflow: hidden;
            background: white;
        }

        .photo-circle img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
        }
        
        .name-label { 
            margin-top: 0.5vh; 
            font-size: 1.2vh; 
            font-weight: bold; 
            color: #333; 
            background: rgba(255,255,255,0.9);
            padding: 0.2vh 0.8vh;
            border-radius: 1vh;
            white-space: nowrap;
        }

/* MOBILE OVERRIDES */
@media (max-width: 768px) {
    body { 
        overflow-y: auto; 
        height: auto; 
    }
    h1 {
        margin-top: 5px !important;    /* Pull title to the top of the screen */
        margin-bottom: 0 !important;   /* Remove space below the title */
    }

    .tree-viewport {
        /* 1. Use 80% of the screen height to make it large */
        height: 80vh; 
        
        /* 2. Set the exact aspect ratio of your new image (Width / Height) */
        aspect-ratio: 514 / 652; 

        /* 3. Ensure it doesn't spill off the sides of narrow phones */
        max-width: 95vw;
        width: auto;

        background-image: url('treemobile.png');
        background-size: contain;
        background-repeat: no-repeat;
        margin: 0px auto;
    }

    /* 4. Keep circles small relative to the taller tree */
    .photo-circle { 
        width: 3.5vh; 
        height: 3.5vh; 
        border-width: 0.2vh;
    }
    
    .name-label { 
        font-size: 0.7vh; 
        padding: 0.1vh 0.3vh;
    }
}
    </style>
</head>
<body>

    <h1><%= familyData.title %></h1>

    <div class="tree-viewport">
        <% familyData.members.forEach((person) => { %>
            <a href="/profile/<%= person.id %>" 
               class="member-card" 
               /* These variables switch between desktop/mobile coordinates automatically */
               data-desktop-top="<%= person.top %>" data-desktop-left="<%= person.left %>"
               data-mobile-top="<%= person.mTop %>" data-mobile-left="<%= person.mLeft %>"
               style="top: <%= person.top %>%; left: <%= person.left %>%;">
                <div class="photo-circle">
                    <img src="<%= person.img %>" alt="<%= person.name %>" onerror="this.src='https://via.placeholder.com/100'">
                </div>
                <span class="name-label"><%= person.name %></span>
            </a>
        <% }) %>
    </div>

<script>
        function updatePositions() {
            // Updated breakpoint to 768px to match the CSS media query
            const isMobile = window.innerWidth <= 768; 
            
            document.querySelectorAll('.member-card').forEach(card => {
                // Use 'mTop/mLeft' for mobile and 'dTop/dLeft' for desktop 
                // to match the data-attributes in your HTML
                const top = isMobile ? card.dataset.mTop : card.dataset.dTop;
                const left = isMobile ? card.dataset.mLeft : card.dataset.dLeft;
                
                if (top && left) {
                    card.style.top = top + '%';
                    card.style.left = left + '%';
                }
            });
        }

        // Listen for window resizing to swap layouts in real-time
        window.addEventListener('resize', updatePositions);
        
        // Run immediately when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', updatePositions);
        
        // Also run once on initial load
        updatePositions();
    </script>

</body>
</html>